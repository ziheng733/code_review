# code review中应该看些什么

CL: changelist

## 设计
+ 代码review中，最重要的事情是看CL的整体设计。  
+ 这些改动中，各个方面的代码交互是否有明确含义?  
+ 这些改动属于代码库，或者依赖包吗？  
+ 这些改动是否很好地与系统其他部分相互融合？  
+ 现在是否适合增加这些功能点？

## 功能
+ 这些改动是否都是开发者想要的？
+ 开发者认为这些改动能为使用者带来什么好处？使用者包括最终用户和代码将来的使用者。
+ 大部分情况下，我们希望开发者在进行code review的时候，代码已经经过了充分完善的测试验证。
+ 但是，作为review者，仍需要考虑边界情况，寻找并发问题，尝试着从使用者的角度出发，保障读过的代码看起来是没有bug的。
+ 如果你想，你可以去验证CL。review者验证CL行为正确性，最重要的时机是用户级的影响发生的时候，比如UI和交互。
+ 有时候你只是阅读代码，会比较难明白这些改动会如何影响用户。当遇到这种情况，你可以邀请开发者提供演示功能的demo来说明。
+ 有时候我们需要专门地去review，一些并发的编码场景，是否会引起死锁或者竞争的场景。
+ 这种并发的场景下，我们非常难通过运行代码发现问题，我们往往需要开发者和review者一起仔细确保死锁等问题不会发生。
+ 值得注意的是：这也是不要滥用并发模型的原因，它可以把问题复杂化，并且降低代码可理解性。

## 复杂性
+ CL会不会过于复杂？
+ 对CL的内容检查每个层次的复杂度：个别行代码太复杂？方法太复杂？类太复杂？
+ “太复杂”通常意味着“不能够被代码阅读者快速看懂”，还意味着“当开发者调用或者修改这些代码时，容易引入bugs”
+ 一种典型的复杂性是“过度工程化(过度设计)”，开发者让代码“过度通用”，或者增加一些目前系统用不上的功能。
+ review者需要特别警惕过度工程化。
+ 应鼓励开发者去解决目前存在的问题，而不是开发者猜测的那些未来“可能”需要解决的问题。
+ 未来的问题应该被一次性解决，当它发生在了具体的场景里，你还能看到它落地的模样和真实的需求。

## 测试
+ 针对改动的部分，要求单元测试，集成测试，端到端测试。
+ 通常来说，测试用例需要在CL提交里面体现，除非是为了解决紧急问题。
+ 需要保证，CL里面的测试用例是正确的，恰当的，以及有用的。
+ 测试用例不会测试自己，我们也很少为测试用例再写测试用例，所以我们需要保证测试用例本身的有效性。
+ 测试用例在代码被破坏后是否真的会不通过，修改底层的代码，是否会表现为测试不通过。
+ 每个测试用例是否足够简单，以及有有效断言？
+ 测试用例是否合适地分离在不同的方法中。
+ 要记住，测试用例也是要不断维护的代码。
+ 不要因为测试用例不在主进程包中，就允许它过度复杂。

## 命名
+ 开发者是否为所有需要的地方，都选择了好的命名？
+ 好的命名, 可以在适合的长度中准确地表达“这是什么”或者“做了什么”，不要过长的命名导致难以阅读。

## 注释
+ 开发者是否有用易懂的英语表达清楚注释？
+ 这些注释，是否全都真正需要？
+ 通常情况下，注释是用于说明代码“为什么存在”，而不是用来说明“代码干了些什么”。
+ 如果代码本身不能清晰地表达自己，那么这些代码需要写得更加简单。
+ 注释也有一些例外，比如复杂的算法，通过注释说明做了什么，可以更加高效地看懂。
+ 不过大部分注释依然只是用来说明，代码不能表达的内容，比如一些决策背后的原因。
+ 在看CL之前，查看注释是有帮助的。又或者现在是一个TODO的注释可以去除了，又或者是一些建议反对这些修改，等等。
+ 要注意的是，注释是不同于类/模块/方法的文档说明，那些说明是用来表达代码的目的，如何使用，以及使用的时候行为如何。

## 文档
+ 如果CL中包括用户如何使用，测试，交互或者发布代码，那么需要一起更新相关的文档，包括README和其他指引文档。
+ 如果CL中删除或者废弃代码，那么认为文档中也应该相应地删除掉。如果漏做了，要求补上。

## 每一行
+ 请review每一行被分配到的代码。
+ 有时候可以跳过review自动生成的代码或大型的数据结构文件，但是人工编写的代码不能忽略。
+ 显而易见的，有些代码应该得到更加细致的关注和review，不过对于所有代码，都至少保持明白是做什么的。
+ 如果发现代码阅读起来困难，速度慢，那么请让开发者意识到这一点并且在开始review前优化他们的代码。
+ 如果你看不懂某些代码，那么意味着其他开发者很大概率也不懂，那么优化代码其实是帮助到未来的开发者也能看懂。
+ 如果你看得懂代码，但是发现某些场景还不够能力review得到，那么请找到一个合适review这种场景的工程师，比如安全/并发/国际化等场景。

## 上下文
+ 在review的时候了解上下文常常是有帮助的。
+ review工具只会展现代码的不同之处，有时候你需要全文阅读来明白修改的含义。
+ 考虑修改的地方对全局的帮助和影响，往往也是有帮助的。修改是否会让代码更加健壮，还是让系统更加复杂，缺乏测试？
+ 不能接受让代码健壮性下降的修改。
+ 很多系统因为不断加入的小修改，而变得越来越复杂，所以阻止“小复杂”的提交是很重要的。

## 好的东西

## 总结

# 说明
+ 翻译自 https://github.com/google/eng-practices/blob/master/review/reviewer/looking-for.md
